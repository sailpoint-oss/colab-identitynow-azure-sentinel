// Usage Instruction : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias (e.g. SailPointIDN_Triggers).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. SailPointIDN_Triggers | take 10).
// References : 
// Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
// Tech Community Blog on KQL Functions : https://techcommunity.microsoft.com/t5/Azure-Sentinel/Using-KQL-functions-to-speed-up-analysis-in-Azure-Sentinel/ba-p/712381
//
let SailPointIDN_Triggers_view  = view () { 
   SailPointIDN_Triggers_CL
    | extend 
        EventVendor="SailPoint",
        EventProduct="SailPoint IdentityNow Triggers",
		Created=column_ifexists('Body_attributes_created_t', ''),
		CustomAttribute1=column_ifexists('Body_attributes_customAttribute1_s', ''),
		CustomAttribute2=column_ifexists('Body_attributes_customAttribute2_s', ''),
		Department=column_ifexists('Body_attributes_department_s', ''),
		DisplayName=column_ifexists('Body_attributes_displayName_s', ''),
		Email=column_ifexists('Body_attributes_email_s', ''),
		EmployeeNumber=column_ifexists('Body_attributes_employeeNumber_s', ''),
		FirstName=column_ifexists('Body_attributes_firstname_s', ''),
		IdentificationNumber=column_ifexists('Body_attributes_identificationNumber_s', ''),
		Inactive=column_ifexists('Body_attributes_inactive_s', ''),
		IsManager=column_ifexists('Body_attributes_isManager_b', ''),
		LastName=column_ifexists('Body_attributes_lastname_s', ''),
		ManagerId=column_ifexists('Body_attributes_manager_id_s', ''),
		ManagerName=column_ifexists('Body_attributes_manager_name_s', ''),
		ManagerType=column_ifexists('Body_attributes_manager_type_s', ''),
		UID=column_ifexists('Body_attributes_uid_s', ''),
		Changes=column_ifexists('Body_changes_s', ''),
		Completed=column_ifexists('Body_completed_t', ''),
		Errors=column_ifexists('Body_errors_s', ''),
	    FileName=column_ifexists('Body_fileName_s', ''),
		IdentityId=column_ifexists('Body_identity_id_g', ''),
		IdentityName=column_ifexists('Body_identity_name_s', ''),
		IdentityType=column_ifexists('Body_identity_type_s', ''),
		OwnerEmail=column_ifexists('Body_ownerEmail_s', ''),
	    OwnerName=column_ifexists('Body_ownerName_s', ''),
		Query=column_ifexists('Body_query_s', ''),
		SearchName=column_ifexists('Body_searchName_s', ''),
		SearchResultAccountCount=column_ifexists('Body_searchResults_Account_count_s', ''),
		SearchResultAccountNoun=column_ifexists('Body_searchResults_Account_noun_s', ''),
		SearchResultAccountPreview=column_ifexists('Body_searchResults_Account_preview_s', ''),
		SearchResultEntitlementCount=column_ifexists('Body_searchResults_Entitlement_count_s', ''),
		SearchResultEntitlementNoun=column_ifexists('Body_searchResults_Entitlement_noun_s', ''),
		SearchResultEntitlementPreview=column_ifexists('Body_searchResults_Entitlement_preview_s', ''),
		SearchResultIdentityCount=column_ifexists('Body_searchResults_Identity_count_s', ''),
		SearchResultIdentityNoun=column_ifexists('Body_searchResults_Identity_noun_s', ''),
		SearchResultIdentityPreview=column_ifexists('Body_searchResults_Identity_preview_s', ''),
		SignedS3Url=column_ifexists('Body_signedS3Url_s', ''),
		SourceId=column_ifexists('Body_source_id_g', ''),
		SourceName=column_ifexists('Body_source_name_s', ''),
		SourceType=column_ifexists('Body_source_type_s', ''),
		Started=column_ifexists('Body_started_t', ''),
		StatsAdded=column_ifexists('Body_stats_added_d', ''),
		StatsChanged=column_ifexists('Body_stats_changed_d', ''),
		StatsRemoved=column_ifexists('Body_stats_removed_d', ''),
		StatsScanned=column_ifexists('Body_stats_scanned_d', ''),
		StatsUnchanged=column_ifexists('Body_stats_unchanged_d', ''),
        Status=column_ifexists('Body_status_s', ''),
		Warnings=column_ifexists('Body_warnings_s', ''),
		InvocationId=column_ifexists('Metadata_invocationId_g', ''),
		TriggerId=column_ifexists('Metadata_triggerId_s', ''),
		TriggerType=column_ifexists('Metadata_triggerType_s', '')
    | project
        TimeGenerated, 
        EventVendor,
        EventProduct,
        Created,
        CustomAttribute1,
        CustomAttribute2,
        Department,
        DisplayName,
        Email,
        EmployeeNumber,
        FirstName,
        IdentificationNumber,
        Inactive,
        IsManager,
        LastName,
        ManagerId,
        ManagerName,
        ManagerType,
        UID,
        Changes,
        Completed,
        Errors,
        FileName,
        IdentityId,
        IdentityName,
        IdentityType,
        OwnerEmail,
        OwnerName,
        Query,
        SearchName,
        SearchResultAccountCount,
        SearchResultAccountNoun,
        SearchResultAccountPreview,
        SearchResultEntitlementCount,
        SearchResultEntitlementNoun,
        SearchResultEntitlementPreview,
        SearchResultIdentityCount,
        SearchResultIdentityNoun,
        SearchResultIdentityPreview,
        SignedS3Url,
        SourceId,
        SourceName,
        SourceType,
        		Started,
        		StatsAdded,
        		StatsChanged,
        		StatsRemoved,
        		StatsScanned,
        		StatsUnchanged,
                Status,
        		Warnings,
        		InvocationId,
        		TriggerId,
        		TriggerType
};
SailPointIDN_Triggers_view